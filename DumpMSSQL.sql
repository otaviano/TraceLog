SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO

CREATE TABLE [TRACELOG].[TIPO_OPERACAO]
(
	[TIO_IDF] [TINYINT] NOT NULL,
	[TIO_NOME] [VARCHAR](15) NOT NULL,
	CONSTRAINT [PKTIPO_OPERACAO] PRIMARY KEY CLUSTERED 
	(
		[TIO_IDF] ASC
	)
	WITH 
	(
		PAD_INDEX  = OFF, 
		STATISTICS_NORECOMPUTE  = OFF, 
		IGNORE_DUP_KEY = OFF, 
		ALLOW_ROW_LOCKS  = ON, 
		ALLOW_PAGE_LOCKS  = ON
	) ON [DATA1]
) ON [DATA1]

GO

CREATE TABLE [TRACELOG].[LOG_BASE]
(
	[LOG_IDF] [BIGINT] IDENTITY(1,1) NOT NULL,
	[LOG_LOGIN] [VARCHAR](30) NOT NULL,
	[LOG_DATA] [DATETIME] NOT NULL,
	CONSTRAINT [PKLOG_BASE] PRIMARY KEY CLUSTERED 
	(
		[LOG_IDF] ASC
	)
	WITH 
	(
		PAD_INDEX  = OFF, 
		STATISTICS_NORECOMPUTE  = OFF, 
		IGNORE_DUP_KEY = OFF, 
		ALLOW_ROW_LOCKS  = ON, 
		ALLOW_PAGE_LOCKS  = ON
	) ON [DATA1]
) ON [DATA1]

GO

CREATE TABLE [TRACELOG].[LOG_ERRO]
(
	[LOG_IDF] [BIGINT] NOT NULL,
	[LOE_NOME_ENTIDADE] [VARCHAR](150) NOT NULL,
	[LOE_NOME_METODO] [VARCHAR](150) NOT NULL,
	[LOE_NOME_ERRO] [VARCHAR](130) NOT NULL,
	[LOE_DESCRICAO_ERRO] [VARCHAR](MAX) NOT NULL,
	[LOG_IDF_PAI] [BIGINT] NULL,
	CONSTRAINT [PKLOG_ERRO] PRIMARY KEY CLUSTERED 
	(
		[LOG_IDF] ASC
	)
	WITH 
	(
		PAD_INDEX  = OFF, 
		STATISTICS_NORECOMPUTE  = OFF, 
		IGNORE_DUP_KEY = OFF, 
		ALLOW_ROW_LOCKS  = ON, 
		ALLOW_PAGE_LOCKS  = ON
	) ON [DATA1]
) ON [DATA1]


CREATE TABLE [TRACELOG].[LOG_TRACE]
(
	[LOG_IDF] [BIGINT] NOT NULL,
	[LOC_OBSERVACAO] [TEXT] NOT NULL,
	CONSTRAINT [PKLOG_TRACE] PRIMARY KEY CLUSTERED 
	(
		[LOG_IDF] ASC
	)
	WITH 
	(
		PAD_INDEX  = OFF, 
		STATISTICS_NORECOMPUTE  = OFF, 
		IGNORE_DUP_KEY = OFF, 
		ALLOW_ROW_LOCKS  = ON, 
		ALLOW_PAGE_LOCKS  = ON
	) ON [DATA1]
) ON [DATA1] TEXTIMAGE_ON [DATA1]

GO

ALTER TABLE [TRACELOG].[LOG_TRACE]  WITH CHECK ADD  CONSTRAINT [FKLOGBASE_LOGTRACE] FOREIGN KEY([LOG_IDF])
REFERENCES [TRACELOG].[LOG_BASE] ([LOG_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_TRACE] CHECK CONSTRAINT [FKLOGBASE_LOGTRACE]
GO

ALTER TABLE [TRACELOG].[LOG_ERRO]  WITH CHECK ADD  CONSTRAINT [FKLOGERRO_LOGERROPAI] FOREIGN KEY([LOG_IDF_PAI])
REFERENCES [TRACELOG].[LOG_ERRO] ([LOG_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_ERRO] CHECK CONSTRAINT [FKLOGERRO_LOGERROPAI]
GO

ALTER TABLE [TRACELOG].[LOG_ERRO]  WITH CHECK ADD  CONSTRAINT [LOGBASE_LOGERRO] FOREIGN KEY([LOG_IDF])
REFERENCES [TRACELOG].[LOG_BASE] ([LOG_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_ERRO] CHECK CONSTRAINT [LOGBASE_LOGERRO]
GO

ALTER TABLE [TRACELOG].[LOG_TRACE]  WITH CHECK ADD  CONSTRAINT [FKLOGBASE_LOGTRACE] FOREIGN KEY([LOG_IDF])
REFERENCES [TRACELOG].[LOG_BASE] ([LOG_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_TRACE] CHECK CONSTRAINT [FKLOGBASE_LOGTRACE]
GO

CREATE TABLE [TRACELOG].[LOG_TRANSACAO]
(
	[LOG_IDF] [bigint] NOT NULL,
	[LON_NOME_ENTIDADE] [varchar](50) NOT NULL,
	[LON_VERSAO_ANTERIOR] [xml] NULL,
	[LON_OBSERVACAO] [text] NULL,
	[LON_DATA_VALIDADE] [datetime] NULL,
	[TIO_IDF] [tinyint] NOT NULL,
	[LON_IDF_ENTIDADE] [int] NULL,
	CONSTRAINT [PKLOG_TRANSACAO] PRIMARY KEY CLUSTERED 
	(
		[LOG_IDF] ASC
	)
		WITH (PAD_INDEX  = OFF, 
		STATISTICS_NORECOMPUTE  = OFF, 
		IGNORE_DUP_KEY = OFF, 
		ALLOW_ROW_LOCKS  = ON, 
		ALLOW_PAGE_LOCKS  = ON
	) ON [DATA1]
) ON [DATA1] TEXTIMAGE_ON [DATA1]

ALTER TABLE [tracelog].[LOG_TRANSACAO]  WITH CHECK ADD  CONSTRAINT [FKLOGBASE_LOGTRANSACAO] FOREIGN KEY([LOG_IDF])
REFERENCES [tracelog].[LOG_BASE] ([LOG_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_TRANSACAO] CHECK CONSTRAINT [FKLOGBASE_LOGTRANSACAO]
GO

ALTER TABLE [TRACELOG].[LOG_TRANSACAO]  WITH CHECK ADD  CONSTRAINT [FKTIPOOPERACAO_LOGTRANSACAO] FOREIGN KEY([TIO_IDF])
REFERENCES [TRACELOG].[TIPO_OPERACAO] ([TIO_IDF])
GO

ALTER TABLE [TRACELOG].[LOG_TRANSACAO] CHECK CONSTRAINT [FKTIPOOPERACAO_LOGTRANSACAO]
GO

SET ANSI_PADDING OFF
GO

-- INSERE A ENUMERAÇÃO DE TIPOS
INSERT INTO TRACELOG.TIPO_OPERACAO
VALUES	(1,'Cadastro'),
		(2,'Alteracao'),	
		(3,'Exclusao'),
		(4,'Visualizacao')
